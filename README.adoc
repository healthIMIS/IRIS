# image:logo/iris-logo.png[width=100] IRIS System

IRIS stands for "Integration of Remote systems into Infection control Software" and is intended to be the central point of mediation between the various contact, event and guest tracking apps on the one hand and the infection control software (e.g. SORMAS) in the health departments on the other.

This repository is used to manage the development and source code of IRIS.

NOTE: The IRIS system is work in progress. If you are interested or have questions please reach out to us.

== Concept

There is a concept written in German which describes the IRIS system: https://github.com/healthIMIS/IRIS-Concept/releases/latest[Last release of the concept]

== IRIS Servers

There are two servers in the IRIS system:

- One for the public Internet, which provides a REST API for the citizen apps and receives the apps' data.
- The second for a secure government network, which fetches the data from the public server and makes it available to the health departments.

The servers are Spring Boot based applications exposing RESTful APIs and running without a user interface.

These are standard Maven projects and just be imported in any IDE. For convenience, enable the <<localDev,`localDev` Maven profile>> so that running the servers from your IDE does not need to access a database, but uses H2 in-memory. <<lombok,Note the use of lombok!>>

=== Quickstart

Run the servers.

[source, bash]
----
$ git clone git@github.com:healthIMIS/IRIS.git iris <1>
$ cd iris/iris-public-server <2>
$ mvnw spring-boot:run -PlocalDev <3>

# in a secound console
$ cd iris/iris-hd-server <4>
$ mvnw spring-boot:run -PlocalDev <3>
----
<1> Clone the repository.
<2> Switch to the public server.
<3> Run the server with an in-memory database.
<4> Switch to the health department server.

=== Libraries

The servers are based on the following open source projects:

- Spring Boot 2.4
- Spring MVC
- Spring Data
- https://flywaydb.org[Flyway] – for database migration
- https://projectlombok.org[Project Lombok] – for low level code generation
- https://www.vavr.io/[Vavr] – for a better more functional programming style

[[lombok]]
IMPORTANT: Make sure you have the Lombok plugin installed in your IDE so that your code can compile correctly.

=== Maven profiles

[[localDev]]
localDev:: Includes H2 database driver as dependency and activates the `dev` Spring profile group and the `local` Spring profile.
NOTE: This profile is activated automaticly if there a file application-local.properties under src/main/resources.

=== Spring profiles

Activate the needed profile(s) by setting the `spring.profiles.active` property respective parameter or the `SPRING_PROFILES_ACTIVE` environment variable.

==== Profile groups
dev:: h2_db, dev_env
dev_psql:: psql_compose_db, dev_env
prod:: prod_db

==== Profiles
local:: Exclusively local profile which is not checked into the Git repository. Can be used to set special settings (e.g. work against a locally installed database). If the profile file `application-local.properties` exist, the <<localDev,Maven profile `localDev`>> is activated for easy local execution.
h2_db:: H2 in-memory database and H2 Console
psql_compose_db:: Configuration for the Postgres database at localhost started with the Docker-Compose: `iris/infrastructure/docker-compose.yml`
prod_db:: Configuration for the production database, where most settings are likely to be made via the respective environment.
dev_env:: Some additional configurations for execution during development (e.g. debug logging).
docker:: Configuration for the Docker image with Postgres database at host postgres. This is intended for use with Docker-Compose: `iris/infrastructure/docker-compose_with-servers.yml`

== Development 
=== Java parts

We use *Java 11* and the code style of the SORMAS developers: https://github.com/hzi-braunschweig/SORMAS-Project/blob/development/DEVELOPMENT_ENVIRONMENT.md[SORMAS Development Environment]

==== Eclipse
https://github.com/hzi-braunschweig/SORMAS-Project/blob/development/sormas-base/java-formatter-profile.xml[sormas-base/java-formatter-profile.xml] +
https://github.com/hzi-braunschweig/SORMAS-Project/blob/development/sormas-base/java-importorder-profile.importorder[sormas-base/java-importorder-profile.importorder]
[quote, relevant part of SORMAS Development Environment from 24.04.2021]
____
Configure automatic code formatting ("Window -> Preferences"):

    - Go to "Java -> Code Style -> Formatter", import sormas-base/java-formatter-profile.xml and apply.
    - Go to "Java -> Code Style -> Organize Imports", import sormas-base/java-importorder-profile.importorder, "Number of imports needed for ." = 99, "Number of static imports needed for ." = 99, "Do not create import for types starting with a lowercase letter" = checked and apply.
    - Go to "Java -> Editor -> Save Actions", activate "Perform the selected actions on save", "Format source code" with "Format all lines", "Organize imports" and apply.
____
